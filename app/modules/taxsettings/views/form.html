<form name="forms" novalidate gumga-form>
    <div class="row" style="position: fixed; width: 101.7%; top: 50px; z-index: 100; font-size: 12px">
        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1 align-layout-panel cl-dark-primary text-uppercase" style="margin: 10px; margin-left: 130px">
            <label style="font-size: 24px" class="ng-binding">CADASTRO DE TRIBUTOS</label>
        </div>
        <div class="col-lg-10 col-md-10 col-sm-10 col-xs-10 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1">
            <!--Valores das arvores da tributação-->
            <div class="panel gmd">
                <div class="panel-body" style="height: 160px">
                    <div class="row">
                        <div class="col-md-2 col-md-offset-1 b-r" ng-click="openPanel()">
                            <label gumga-translate-tag="taxsettings.operation" align="center" class="cursor-pointer">
                                OPERATION</label>
                            <div class="list-5-scroll">
                                <label ng-repeat="ot in entity.operationTypes track by $index"
                                   class="text-muted cursor-pointer">
                                    - {{ot.name}}</label>
                            </div>
                        </div>
                        <div class="col-md-2 b-r" ng-click="openPanel()">
                            <label gumga-translate-tag="taxsettings.origin" align="center" class="cursor-pointer">
                                ORIGIN</label>

                            <div class="list-5-scroll">
                                <label ng-repeat="or in entity.origins track by $index" class="text-muted cursor-pointer">
                                    - {{or.label}}</label></div>
                        </div>
                        <div class="col-md-2 b-r" ng-click="openPanel()">
                            <label gumga-translate-tag="taxsettings.destination" align="center" class="cursor-pointer">
                                DESTINATION</label>

                            <div class="list-5-scroll">
                                <label ng-repeat="des in entity.destinations track by $index"
                                   class="text-muted cursor-pointer">- {{des.label}}</label>
                            </div>
                        </div>
                        <div class="col-md-2 b-r" ng-click="openPanel()">
                            <label gumga-translate-tag="taxsettings.person" align="center" class="cursor-pointer">
                                PERSON</label>

                            <div class="list-5-scroll">
                                <label ng-repeat="pg in entity.personGroups track by $index"
                                   class="text-muted cursor-pointer">- {{pg.name}}</label></div>
                        </div>
                        <div class="col-md-2" ng-click="openPanel()">
                            <label gumga-translate-tag="taxsettings.product" align="center" class="cursor-pointer">
                                PRODUCT</label>

                            <div class="list-5-scroll">
                                <label ng-repeat="pg in entity.productGroups track by $index"
                                   class="text-muted cursor-pointer">- {{pg.name}}</label></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-10 col-md-offset-1" style="top: 232px">
            <!--Arvore de tributação-->
            <div class="panel gmd" ng-show="configOpen">
                <div class="panel-body">
                    <div class="row">
                        <!--Passo 1-->
                        <div ng-hide="step2">
                            <!--Tipo de operação-->
                            <div class="col-md-2 col-md-offset-1" align="center" style="font-size: 11px">
                                <h4 gumga-translate-tag="taxsettings.operation" class="b">OPERATION</h4>
                                <div style="max-height: 282px; overflow-y: auto;">
                                    <gumga-list data="operationTypesList"
                                                configuration="confOperation"
                                                class="table-bordered"
                                                selected-values="entity.operationTypes"></gumga-list>
                                </div>
                            </div>
                            <!--Origem-->
                            <div class="col-md-2" align="center" style="font-size: 11px">
                                <h4 gumga-translate-tag="taxsettings.origin" class="b">ORIGIN</h4>

                                <div style="max-height: 282px; overflow-y: auto;">
                                    <gumga-list data="stateOriginList"
                                                configuration="confState"
                                                class="table-bordered" selected-values="entity.origins"></gumga-list>
                                </div>
                            </div>
                            <!--Destino-->
                            <div class="col-md-2" align="center" style="font-size: 11px">
                                <h4 gumga-translate-tag="taxsettings.destination" class="b">DESTINATION</h4>

                                <div style="max-height: 282px; overflow-y: auto;">
                                    <gumga-list data="stateDestinationList"
                                                configuration="confState"
                                                class="table-bordered"
                                                selected-values="entity.destinations"></gumga-list>
                                </div>
                            </div>
                            <!--Tipo de Pessoa-->
                            <div class="col-md-2" align="center" style="font-size: 11px">
                                <h4 gumga-translate-tag="taxsettings.person" class="b">PERSON</h4>

                                <div style="max-height: 282px; overflow-y: auto;">
                                    <gumga-list data="personGroupList"
                                                configuration="confPerson"
                                                class="table-bordered"
                                                selected-values="entity.personGroups"></gumga-list>
                                </div>
                            </div>
                            <!--Tipo de Produto-->
                            <div class="col-md-2" align="center" style="font-size: 11px">
                                <h4 gumga-translate-tag="taxsettings.product" class="b">PRODUCT</h4>

                                <div style="max-height: 282px; overflow-y: auto;">
                                    <gumga-list data="productGroupList"
                                                configuration="confProduct"
                                                class="table-bordered"
                                                selected-values="entity.productGroups"></gumga-list>
                                </div>
                            </div>

                            <div class="col-md-1">
                                <button type="button" class="btn btn-primary btn-circle btn-lg form-control"
                                        uib-tooltip="Tributar" style="margin-top: 140px;"
                                        ng-click="openTaxation = true; configOpen = false;"
                                        ng-disabled="blockBtnTributos(entity)">
                                    <i class="fa fa-calculator fa-lg" style="margin-left: -3px;"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--Nome da tributação-->
            <div class="panel gmd" ng-if="openTaxation">
                <div class="panel-body">
                    <div class="row m-t">
                        <div class="col-md-12">
                            <gmd-input>
                                <input type="text" class="form-control gmd" ng-model="entity.name" style="font-size: 20px"/>
                                <span class="bar"></span>
                                <label class="control-label" gumga-translate-tag="taxsettings.titleparameterization">Title
                                    parameterization</label>
                            </gmd-input>
                        </div>
                    </div>
                    <!--ICMS-->
                    <div class="panel gmd">
                        <div align="left" class="panel-heading" >
                            <label class="btn-link"
                                   ng-click="showICMS = !showICMS" style="font-size: 14px"><i
                                    ng-class="{'fa fa-caret-down' :showICMS, 'fa fa-caret-right':!showICMS}"></i> <span>PARÂMETROS DA TRIBUTAÇÃO DO ICMS</span></label>
                        </div>
                        <div class="panel-body" ng-show="showICMS" style="font-size: 13px">
                            <div class="row container-fluid">

                                <div class="row m-t">
                                    <div class="col-md-4">
                                        <label>CFOP</label>
                                        <gumga-many-to-one
                                                value="icms.cfop"
                                                search-method="getCfopIcms(param)"
                                                field="descricao"
                                                async="true"
                                                display-info="false"
                                                editable="false">
                                            <match>
                                                <div>{{match.model.codigo}}</div>
                                                <div>{{match.model.descricao}}</div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                    <div class="col-md-4" ng-show="icmsNormal">
                                        <label>CST</label>
                                        <select name="icmsCst" id="icmsCst" ng-model="icms.CST"
                                                ng-options="cst.key as cst.label for cst in icmsTypes"
                                                class="form-control"></select>
                                    </div>
                                    <div class="col-md-4" ng-hide="icmsNormal">
                                        <label>CSOSN</label>
                                        <select name="CSOSN" id="CSOSN" ng-model="icms.CSOSN"
                                                ng-options="cst.key as cst.label for cst in csosnTypes"
                                                class="form-control"></select>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Mensagem</label>
                                        <gumga-many-to-one
                                                value="icms.mensagem"
                                                search-method="getMensagem(param,'ICMS')"
                                                field="name"
                                                async="true"
                                                display-info="false"
                                                editable="false">
                                            <match>
                                                <div>{{match.model.name}}</div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                </div>
                                <div class="row m-t" ng-show="icmsNormal">
                                    <div class="col-md-6">
                                        <div ng-hide="isIcmsAble(icms)">
                                            <div class="row" align="center">
                                                <h4 class="b">
                                                    ICMS</h4>
                                            </div>
                                            <div ng-show="isIcmsStandartGroupAble(icms)">
                                                <div class="row">
                                                    <div class="col-md-7">
                                                        <label>Modalidade Deter. da BC ICMS</label>
                                                        <select name="icmsModBC" id="icmsModBC" ng-model="icms.modBC"
                                                                class="form-control"
                                                                ng-options="mod.key as mod.label for mod in modeCalculationBaseList"></select>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <label>Fórmula Valor da BC ICMS</label>
                                                        <gumga-many-to-one
                                                                value="icms.vBC"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                                <div class="row m-t">
                                                    <div class="col-md-5">
                                                        <label>Alíquota ICMS</label>
                                                        <input type="text" class="form-control" ui-percentage-mask
                                                               ng-model="icms.pICMS"/>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <label>Fórmula Valor ICMS</label>

                                                        <gumga-many-to-one
                                                                value="icms.vICMS"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row" ng-show="isRedGroupAble(icms)">
                                                <div class="col-md-5 m-t container-fluid">
                                                    <label>Redução da BC ICMS</label>
                                                    <input type="text" class="form-control" ng-model="icms.pRedBC"
                                                           ui-percentage-mask/>
                                                </div>
                                                <div class="col-md-7 m-t"
                                                     ng-hide="!(icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'OUTRAS_COM_PARTILHA_90')">
                                                    <label>BC da operação própria</label>
                                                    <input type="text" class="form-control" ng-model="icms.pBCOp"
                                                           ui-percentage-mask/>
                                                </div>
                                            </div>
                                            <div ng-show="isIcmsDesoGroupAble(icms)">
                                                <div class="row">
                                                    <div class="col-md-7 m-t">
                                                        <label>Valor ICMS Desonerado</label>

                                                        <gumga-many-to-one
                                                                value="icms.vICMSDeson"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 m-t">
                                                    <div class="row">
                                                        <label>Motivo da desoneração</label>
                                                        <select name="icmsMotDes" id="icmsMotDes"
                                                                ng-model="icms.motDesICMS"
                                                                class="form-control"
                                                                ng-options="obj.key as obj.label for obj in unburdeningMotiveList"></select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div ng-show="icms.CST == 'DIFERIMENTO_51'">
                                                <div class="row m-t">
                                                    <div class="col-md-7">
                                                        <label>ICMS da Operação</label>
                                                        <gumga-many-to-one
                                                                value="icms.vICMSOp"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <label>Percentual do Diferimento</label>
                                                        <input type="text" class="form-control" ui-percentage-mask
                                                               ng-model="icms.pDif"/>
                                                    </div>
                                                </div>
                                                <div class="row m-t">
                                                    <div class="col-md-7">
                                                        <label>Valor do ICMS diferido</label>
                                                        <gumga-many-to-one
                                                                value="icms.vICMSDif"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row m-t" ng-show="isFCPVisible(icms)">
                                                <div class="col-md-6">
                                                    <label>Alíquota interna da UF de destino</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pICMSUFDest"/>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Perc. Fundo Comb. à Pobreza</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pFCPUFDest"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" ng-hide="isIcmsStAble(icms)">
                                        <div class="row" align="center">
                                            <h4 class="b">
                                                ICMS ST</h4>
                                        </div>
                                        <div ng-hide="isIcmsStStandartGroupAble(icms)">
                                            <div class="row">
                                                <div class="col-md-7">
                                                    <label>Modalidade Deter. da BC ICMS ST</label>
                                                    <select name="icmsmodBCST" id="icmsBCST" ng-model="icms.modBCST"
                                                            class="form-control"
                                                            ng-options="modst.key as modst.label for modst in modeCalculationBaseSTList"></select>
                                                </div>
                                                <div class="col-md-5"
                                                     ng-show="icms.CST == 'COBRANCA_ST_10' || icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'ISENTA_COM_ST_30' || icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                    <label>Redução BC ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pRedBCST"/>
                                                </div>
                                            </div>
                                            <div class="row m-t">
                                                <div class="col-md-5"
                                                     ng-show="icms.CST == 'COBRANCA_ST_10' || icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'ISENTA_COM_ST_30' || icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                    <label>Margem valor adic. ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pMVAST"/>
                                                </div>
                                                <div class="col-md-7"
                                                     ng-show="icms.CST == 'COBRANCA_ST_10' || icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'ISENTA_COM_ST_30' || icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                    <label>Fórmula Valor BC ICMS ST</label>
                                                    <gumga-many-to-one
                                                            value="icms.vBCST"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                            <div class="row m-t">
                                                <div class="col-md-5"
                                                     ng-show="icms.CST == 'COBRANCA_ST_10' || icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'ISENTA_COM_ST_30' || icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                    <label>Alíquota ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pICMSST"/>
                                                </div>
                                                <div class="col-md-7"
                                                     ng-show="icms.CST == 'COBRANCA_ST_10' || icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'ISENTA_COM_ST_30' || icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                    <label>Fórmula Valor ICMS ST</label>
                                                    <gumga-many-to-one
                                                            value="icms.vICMSST"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row m-t"
                                             ng-show="icms.CST == 'COBRANCA_ST_10_COM_PARTILHA' || icms.CST == 'OUTRAS_COM_PARTILHA_90'">
                                            <div class="col-md-6">
                                                <label>UF do ICMS ST devido na operação</label>
                                                <select name="icmsuficmsdo" id="icmsuficmsdo" ng-model="icms.UFST"
                                                        class="form-control"
                                                        ng-options="obj.key as obj.label for obj in stateList"></select>
                                            </div>
                                        </div>
                                        <div ng-show="icms.CST == 'ISENTA_COM_ST_30'">
                                            <div class="row m-t">
                                                <div class="col-md-5">
                                                    <label>Valor ICMS Desonerado</label>

                                                    <gumga-many-to-one
                                                            value="icms.vICMSDeson"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                            <div class="col-md-12 m-t">
                                                <div class="row">
                                                    <label>Motivo da desoneração</label>
                                                    <select name="modIcmsSetDeson" id="modIcmsSetDeson"
                                                            ng-model="icms.motDesICMS" class="form-control"
                                                            ng-options="obj.key as obj.label for obj in unburdeningMotiveList"></select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row"
                                             ng-show="icms.CST == 'NAO_TRIBUTADA_41_ICMSST' || icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60'">
                                            <div class="col-md-6">
                                                <label ng-hide="icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60'">BC ICMS
                                                    ST
                                                    retido na UF remet.</label>
                                                <label ng-show="icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60'">BC ICMS
                                                    ST
                                                    retido anteriormente</label>
                                                <gumga-many-to-one
                                                        value="icms.vBCSTRet"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                            <div class="col-md-6">
                                                <label ng-hide="icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60'">ICMS ST
                                                    retido
                                                    na UF remet.</label>
                                                <label ng-show="icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60'">ICMS ST
                                                    retido
                                                    anteriormente</label>
                                                <gumga-many-to-one
                                                        value="icms.vICMSSTRet"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-5"
                                                 ng-show="icms.CST == 'COBRADO_ANTERIORMENTE_POR_ST_60' ||icms.CST == 'ST_REDUCAO_BC_70' || icms.CST == 'OUTRAS_COM_PARTILHA_90' || icms.CST == 'OUTROS_90'">
                                                <label>Redução ICMS ST Próprio</label>
                                                <input type="text" class="form-control" ui-percentage-mask
                                                       ng-model="icms.pRedIMCSSTProp"/>
                                            </div>
                                        </div>
                                        <div class="row m-t" ng-show="icms.CST == 'NAO_TRIBUTADA_41_ICMSST'">
                                            <div class="col-md-6">
                                                <label>BC ICMS ST da UF destino</label>

                                                <gumga-many-to-one
                                                        value="icms.vBCSTDest"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                            <div class="col-md-6">
                                                <label>ICMS ST da UF destino</label>
                                                <gumga-many-to-one
                                                        value="icms.vICMSSTDest"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row m-t" ng-hide="icmsNormal">
                                    <div class="col-md-6">
                                        <div ng-show="showSimples(icms)">
                                            <div class="row " align="center">
                                                <h4 class="b">
                                                    ICMS</h4>
                                            </div>
                                            <div ng-show="icms.CSOSN === 'OUTROS_900'" class="m-b">
                                                <div class="row">
                                                    <div class="col-md-7">
                                                        <label>Modalidade Deter. da BC ICMS</label>
                                                        <select name="icmsModBC" ng-model="icms.modBC"
                                                                class="form-control"
                                                                ng-options="mod.key as mod.label for mod in modeCalculationBaseList"></select>
                                                    </div>
                                                    <div class="col-md-5">
                                                        <label>Fórmula Valor da BC ICMS</label>
                                                        <gumga-many-to-one
                                                                value="icms.vBC"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                                <div class="row m-t">
                                                    <div class="col-md-5">
                                                        <label>Alíquota ICMS</label>
                                                        <input type="text" class="form-control" ui-percentage-mask
                                                               ng-model="icms.pICMS"/>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <label>Fórmula Valor ICMS</label>


                                                        <gumga-many-to-one
                                                                value="icms.vICMS"
                                                                search-method="getFormulaIcms(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-5 m-t container-fluid">
                                                        <label>Redução da BC ICMS</label>
                                                        <input type="text" class="form-control" ng-model="icms.pRedBC" ui-percentage-mask/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row " ng-if="showAliquotaGroup(icms)">
                                                <div class="col-md-7" ng-show="icms.CSOSN !== 'CREDITO_101'">
                                                    <label>Alíquota aplicável de cálculo do crédito</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pCredSN"/>
                                                </div>
                                                <div class="col-md-5">
                                                    <label>Fórmula Vl. crédito do ICMS</label>
                                                    <gumga-many-to-one
                                                            value="icms.vCredICMSSN"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                            <div class="row m-t" ng-show="isFCPVisible(icms)">
                                                <div class="col-md-6">
                                                    <label>Alíquota interna da UF de destino</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pICMSUFDest"/>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Perc. Fundo Comb. à Pobreza</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pFCPUFDest"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" ng-show="showSimplesSt(icms)">
                                        <div class="row" align="center">
                                            <h4 class="b">
                                                ICMS ST</h4>
                                        </div>
                                        <div ng-show="showIcmsStSimple(icms)">
                                            <div class="row" >
                                                <div class="col-md-7">
                                                    <label>Modalidade Deter. da BC ICMS ST</label>
                                                    <select name="icmsmodBCST" ng-model="icms.modBCST"
                                                            class="form-control"
                                                            ng-options="modst.key as modst.label for modst in modeCalculationBaseSTList"></select>
                                                </div>
                                                <div class="col-md-5" >
                                                    <label>Redução BC ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pRedBCST"/>
                                                </div>
                                            </div>
                                            <div class="row m-t">
                                                <div class="col-md-5" ng-if="icms.modBCST !== 'PAUTA'">
                                                    <label>Margem valor adic. ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pMVAST"/>
                                                </div>
                                                <div class="col-md-7 pull-right">
                                                    <label>Fórmula Valor BC ICMS ST</label>

                                                    <gumga-many-to-one
                                                            value="icms.vBCST"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                            <div class="row m-t">
                                                <div class="col-md-5">
                                                    <label>Alíquota ICMS ST</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="icms.pICMSST"/>
                                                </div>
                                                <div class="col-md-7">
                                                    <label>Fórmula Valor ICMS ST</label>

                                                    <gumga-many-to-one
                                                            value="icms.vICMSST"
                                                            search-method="getFormulaIcms(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row" ng-show="icms.CSOSN === 'ANTECIPACAO_ST_500'">
                                            <div class="col-md-6">
                                                <label>BC ICMS
                                                    ST
                                                    retido anteriormente</label>
                                                <gumga-many-to-one
                                                        value="icms.vBCSTRet"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                            <div class="col-md-6">
                                                <label>ICMS ST
                                                    retido
                                                    anteriormente</label>
                                                <gumga-many-to-one
                                                        value="icms.vICMSSTRet"
                                                        search-method="getFormulaIcms(param)"
                                                        field="name"
                                                        async="true"
                                                        display-info="false"
                                                        editable="false">
                                                    <match>
                                                        <div>{{match.model.name}}</div>
                                                    </match>
                                                </gumga-many-to-one>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--PIS-->
                    <div class="panel gmd">
                        <div align="left" class="panel-heading">
                            <label class="btn-link"
                                   ng-click="showPIS = !showPIS" style="font-size: 14px">
                                <i ng-class="{'fa fa-caret-down' :showPIS, 'fa fa-caret-right':!showPIS}"></i>
                                <span>PARÂMETROS DA TRIBUTAÇÃO DO PIS</span>
                            </label>
                        </div>
                        <div class="panel-body" ng-show="showPIS" style="font-size: 13px">
                            <div class="row container-fluid">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>CST</label>
                                        <select name="cstpis" id="cstpis" ng-model="pis.CST" class="form-control"
                                                ng-options="obj.key as obj.label for obj in cstpis"></select>
                                    </div>
                                    <div class="col-md-6">
                                        <label>Mensagem</label>

                                        <gumga-many-to-one
                                                value="pis.mensagem"
                                                search-method="getMensagem(param,'PIS')"
                                                field="name"
                                                async="true"
                                                display-info="false"
                                                editable="false">
                                            <match>
                                                <div>{{match.model.name}}</div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                </div>
                                <div class="row m-t" ng-hide="isPisAble(pis)">
                                    <div class="col-md-6">
                                        <div ng-hide="pis.CST == 'OPERACAO_TRIBUTAVEL_05'">

                                            <div class="row">
                                                <h4 class="b" align="center">PIS</h4>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6" ng-hide="isPisOperationTypeUnable(pis)">
                                                    <label>Tipo de cálculo</label>
                                                    <select name="calculationpis" id="calculationpis"
                                                            ng-model="pis.calculationType" class="form-control"
                                                            ng-options="obj for obj in calculationTypes"></select>
                                                </div>
                                                <div class="row" ng-show="isPisAliquotaAble(pis)">
                                                    <div class="col-md-12">
                                                        <div class="row">
                                                            <div class="col-md-12">

                                                                <div class="col-md-6">
                                                                    <label>Valor da base de cálculo</label>

                                                                    <gumga-many-to-one
                                                                            value="pis.vBC"
                                                                            search-method="getFormulaPis(param)"
                                                                            field="name"
                                                                            async="true"
                                                                            display-info="false"
                                                                            editable="false">
                                                                        <match>
                                                                            <div>{{match.model.name}}</div>
                                                                        </match>
                                                                    </gumga-many-to-one>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <label>Alíquota (percentual)</label>
                                                                    <input type="text" class="form-control"
                                                                           ui-percentage-mask
                                                                           ng-model="pis.pPIS"/>
                                                                </div>

                                                            </div>
                                                        </div>

                                                        <div class="col-md-6 m-t">
                                                            <label>Valor do PIS</label>

                                                            <gumga-many-to-one
                                                                    value="pis.vPIS"
                                                                    search-method="getFormulaPis(param)"
                                                                    field="name"
                                                                    async="true"
                                                                    display-info="false"
                                                                    editable="false">
                                                                <match>
                                                                    <div>{{match.model.name}}</div>
                                                                </match>
                                                            </gumga-many-to-one>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" ng-show="pis.CST === 'OPERACAO_TRIBUTAVEL_05'">
                                        <div class="row">
                                            <h4 class="b" align="center">PIS ST</h4>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Tipo de cálculo</label>
                                                <select name="calculationpisst" id="calculationpisst"
                                                        ng-model="pis.calculationTypeST" class="form-control"
                                                        ng-options="obj for obj in calculationTypes"></select>
                                            </div>
                                        </div>
                                        <div class="row" ng-show=" pis.calculationTypeST == 'PORCENTAGEM'">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="col-md-6 m-t">
                                                        <label>Valor da base de cálculo</label>

                                                        <gumga-many-to-one
                                                                value="pis.vBCST"
                                                                search-method="getFormulaPis(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                    <div class="col-md-6 m-t">
                                                        <label>Alíquota (percentual)</label>
                                                        <input type="text" class="form-control" ui-percentage-mask
                                                               ng-model="pis.pPISST"/>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="col-md-6 m-t">
                                                        <label>Valor do PIS ST</label>

                                                        <gumga-many-to-one
                                                                value="pis.vPISST"
                                                                search-method="getFormulaPis(param)"
                                                                field="name"
                                                                async="true"
                                                                display-info="false"
                                                                editable="false">
                                                            <match>
                                                                <div>{{match.model.name}}</div>
                                                            </match>
                                                        </gumga-many-to-one>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--COFINS-->
                    <div class="panel gmd">
                        <div align="left" class="panel-heading">
                            <label class="btn-link"
                                   ng-click="showCOFINS = !showCOFINS" style="font-size: 14px"><i
                                    ng-class="{'fa fa-caret-down':showCOFINS, 'fa fa-caret-right':!showCOFINS}"></i>
                                <span>PARÂMETROS DA TRIBUTAÇÃO DO COFINS</span></label>
                        </div>
                        <div class="panel-body" ng-show="showCOFINS" style="font-size: 13px">
                            <div class="row container-fluid">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label>CST</label>
                                        <select name="cstcofins" id="cstcofins" ng-model="cofins.CST"
                                                class="form-control"
                                                ng-options="obj.key as obj.label for obj in cstpis"></select>

                                    </div>
                                    <div class="col-md-6">
                                        <label>Mensagem</label>
                                        <gumga-many-to-one
                                                value="cofins.mensagem"
                                                search-method="getMensagem(param,'COFINS')"
                                                field="name"
                                                async="true"
                                                display-info="false"
                                                editable="false">
                                            <match>
                                                <div>{{match.model.name}}</div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                </div>
                                <div class="row m-t" ng-hide="isCofinsAble(cofins)">
                                    <div class="col-md-6">
                                        <div ng-hide="cofins.CST == 'OPERACAO_TRIBUTAVEL_05'">
                                            <div class="row">
                                                <h4 class="b" align="center">COFINS</h4>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6" ng-hide="isCofinsOperationTypeUnable(cofins)">
                                                    <label>Tipo de cálculo</label>
                                                    <select name="calculationcofins" id="calculationcofins"
                                                            ng-model="cofins.calculationType" class="form-control"
                                                            ng-options="obj for obj in calculationTypes"></select>
                                                </div>
                                                <div class="row" ng-show="isCofinsAliquotaAble(cofins)">
                                                    <div class="col-md-12">
                                                        <div class="row">
                                                            <div class="col-md-12">
                                                                <div class="col-md-6 m-t">
                                                                    <label>Valor da base de cálculo</label>

                                                                    <gumga-many-to-one
                                                                            value="cofins.vBC"
                                                                            search-method="getFormulaCofins(param)"
                                                                            field="name"
                                                                            async="true"
                                                                            display-info="false"
                                                                            editable="false">
                                                                        <match>
                                                                            <div>{{match.model.name}}</div>
                                                                        </match>
                                                                    </gumga-many-to-one>
                                                                </div>
                                                                <div class="col-md-6 m-t">
                                                                    <label>Alíquota (percentual)</label>
                                                                    <input type="text" class="form-control"
                                                                           ui-percentage-mask
                                                                           ng-model="cofins.pCOFINS"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 m-t">
                                                            <label>Valor do COFINS</label>

                                                            <gumga-many-to-one
                                                                    value="cofins.vCOFINS"
                                                                    search-method="getFormulaCofins(param)"
                                                                    field="name"
                                                                    async="true"
                                                                    display-info="false"
                                                                    editable="false">
                                                                <match>
                                                                    <div>{{match.model.name}}</div>
                                                                </match>
                                                            </gumga-many-to-one>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" ng-show="cofins.CST === 'OPERACAO_TRIBUTAVEL_05'">
                                        <div class="row">
                                            <h4 class="b" align="center">COFINS ST</h4>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Tipo de cálculo</label>
                                                <select name="calculationcofinsst" id="calculationcofinsst"
                                                        ng-model="cofins.calculationTypeST" class="form-control"
                                                        ng-options="obj for obj in calculationTypes"></select>
                                            </div>
                                        </div>
                                        <div ng-show="cofins.calculationTypeST == 'PORCENTAGEM'">
                                            <div class="row">

                                                <div class="col-md-6 m-t">
                                                    <label>Valor da base de cálculo</label>

                                                    <gumga-many-to-one
                                                            value="cofins.vBCST"
                                                            search-method="getFormulaCofins(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                                <div class="col-md-4 m-t">
                                                    <label>Alíquota (percentual)</label>
                                                    <input type="text" class="form-control" ui-percentage-mask
                                                           ng-model="cofins.pCOFINSST"/>
                                                </div>
                                            </div>
                                            <div class="row">

                                                <div class="col-md-6 m-t">
                                                    <label>Valor do COFINS ST</label>

                                                    <gumga-many-to-one
                                                            value="cofins.vCOFINSST"
                                                            search-method="getFormulaCofins(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--IPI-->
                    <div class="panel gmd">
                        <div align="left" class="panel-heading">
                            <label class="btn-link"
                                   ng-click="showIPI = !showIPI" style="font-size: 14px"><i
                                    ng-class="{'fa fa-caret-down' :showIPI, 'fa fa-caret-right':!showIPI }"></i> <span>PARÂMETROS DA TRIBUTAÇÃO DO IPI</span></label>
                        </div>
                        <div class="panel-body" ng-show="showIPI" style="font-size: 13px">
                            <div class="row container-fluid">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label>CST</label>
                                        <select name="cstipi" id="cstipi" ng-model="ipi.CST"
                                                class="form-control"
                                                ng-options="obj.key as obj.label for obj in cstipi"></select>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Cód. Enquadramento legal do IPI</label>
                                        <gumga-many-to-one
                                                value="ipi.enquadramentoIpi"
                                                search-method="searchEnquadramento(param)"
                                                class="gmd"
                                                field="descricao"
                                                display-info="false"
                                                async="true">
                                            <match>
                                                <div>{{match.model.codigo}} - {{match.model.descricao}}
                                                </div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                    <div class="col-md-4">
                                        <label>Mensagem</label>
                                        <gumga-many-to-one
                                                value="ipi.mensagem"
                                                search-method="getMensagem(param,'IPI')"
                                                field="name"
                                                async="true"
                                                display-info="false"
                                                editable="false">
                                            <match>
                                                <div>{{match.model.name}}</div>
                                            </match>
                                        </gumga-many-to-one>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row m-t" ng-hide="isIpiAble(ipi)">

                                            <div class="col-md-6">
                                                <label>Tipo de cálculo</label>
                                                <select name="calculationipi" id="calculationipi"
                                                        ng-model="ipi.ipiCalculationType"
                                                        class="form-control"
                                                        ng-options="obj for obj in calculationTypes"></select>
                                            </div>
                                            <div ng-show="ipi.ipiCalculationType == 'PORCENTAGEM'">
                                                <div class="row">
                                                    <div class="col-md-12">

                                                        <div class="col-md-6 m-t">
                                                            <label>Valor da base de cálculo</label>

                                                            <gumga-many-to-one
                                                                    value="ipi.vBC"
                                                                    search-method="getFormulaIpi(param)"
                                                                    field="name"
                                                                    async="true"
                                                                    display-info="false"
                                                                    editable="false">
                                                                <match>
                                                                    <div>{{match.model.name}}</div>
                                                                </match>
                                                            </gumga-many-to-one>
                                                        </div>
                                                        <div class="col-md-6 m-t">
                                                            <label>Alíquota</label>
                                                            <input type="text" class="form-control" ui-percentage-mask
                                                                   ng-model="ipi.pIPI"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 m-t">
                                                    <label>Valor do IPI</label>
                                                    <gumga-many-to-one
                                                            value="ipi.vIPI"
                                                            search-method="getFormulaIpi(param)"
                                                            field="name"
                                                            async="true"
                                                            display-info="false"
                                                            editable="false">
                                                        <match>
                                                            <div>{{match.model.name}}</div>
                                                        </match>
                                                    </gumga-many-to-one>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <gmd-fab force-click="false" fixed opened="!fabs" style="z-index: 99">
                <button class="bg-accent gmd-ripple"
                        type="button"
                        ng-class="{ 'gmd-disabled' : blockBtnTributos(entity) || saveDisabled(entity,icms,pis,cofins,ipi) }"
                        ng-click="update(entity,icms,pis,cofins,ipi, blockBtnTributos(entity) || saveDisabled(entity,icms,pis,cofins,ipi))">
                    <span class="material-icons">check</span>
                </button>
                <ul>
                    <li class="bg-primary" ng-show="entity.id" ui-sref="taxsettings.list">
                        <span>Voltar</span>
                        <i class="material-icons gmd-ripple">keyboard_backspace</i>
                    </li>
                    <li class="bg-primary" ng-click="clearPage()">
                        <span>Limpar</span>
                        <i class="material-icons gmd-ripple">delete_sweep</i>
                    </li>
                    <li class="btn-danger" ng-hide="entity.id" ui-sref="taxsettings.list">
                        <span>Cancelar</span>
                        <i class="material-icons gmd-ripple">close</i>
                    </li>
                    <li class="bg-primary" ng-show="entity.id" ng-click="replicateTaxSetting()">
                        <span>Replicar</span>
                        <i class="material-icons gmd-ripple">content_copy</i>
                    </li>
                </ul>
            </gmd-fab>
        </div>
    </div>
</form>